<!DOCTYPE html>
<html lang="en">
<head>
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Serialization demo</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="../dist/gridstack.css"/>
	
	
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.0/jquery-ui.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.5.0/lodash.min.js"></script>
    <script src="../dist/gridstack.js"></script>
    <script src="../dist/gridstack.jQueryUI.js"></script>

	
	
    <style type="text/css">
        .grid-stack {
            background: #ffffff;
        }

        .grid-stack-item-content {
            color: #2c3e50;
            text-align: center;
            background-color: #ffb868;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <h1>Serialization demo</h1>


		
        <div>
            <a class="btn btn-default" id="add-box" href="#">Add Note</a>
			<a class="btn btn-default" id="save-grid" href="#">Save Grid</a>
            <a class="btn btn-default" id="load-grid" href="#">Load Grid</a>
            <a class="btn btn-default" id="clear-grid" href="#">Clear Grid</a>
        </div>

        <br/>

        <div class="grid-stack">
        </div>
		
		<br>
		


        <hr/>

        <textarea id="saved-data" cols="100" rows="20" readonly="readonly"></textarea>
    </div>


    <script type="text/javascript">
        //The template for adding delete buttons
		

		
		
		$(function () {
            var options = {
            };
            $('.grid-stack').gridstack(options);
						
						off=0;
						on=1;
						maxId = 0;

						changeHand = on;
		
				/*==============================================================
				IMPORTANT:
				This looks like some initialization data for the boxes,
				this would need to be stored somewhere on our server and called
				to initialize the sizes and positions of the user's notes
				================================================================*/
                this.serializedData = [ 
                    {x: 0, y: 0, width: 2, height: 2, id: 1},
                    {x: 3, y: 1, width: 1, height: 2, id: 2},
                    {x: 4, y: 1, width: 1, height: 1, id: 3},
                    {x: 2, y: 3, width: 3, height: 1, id: 4},
                    {x: 1, y: 4, width: 1, height: 1, id: 5},
                    {x: 1, y: 3, width: 1, height: 1, id: 6},
                    {x: 2, y: 4, width: 1, height: 2, id: 7},
                    {x: 2, y: 5, width: 1, height: 1, id: 8}
                ];
				

				//This just calls gridstack for the page 
                this.grid = $('.grid-stack').data('gridstack');
				
							
				this.addBox = function(){
					changeHand = off;
					
					$('.grid-stack').gridstack();
					
					var grid = $('.grid-stack').data('gridstack');
					this.grid.addWidget($('<div><div id="'+maxId+1+'" class="grid-stack-item-content" style=" color: #2c3e50; text-align: center; background-color: #ffb868;" /><div/>'), 0, 0, 2, 2,true,null,null, null, null,maxId+1);
					

					console.log('Saving Grid');
					this.saveGrid();
					
					console.log('Loading Grid');
					this.loadGrid();
					
					changeHand = on;

					
					return false;
				}.bind(this);
				
				
				
				
				
				this.deleteBox = function (item) {
                    self.widgets.remove(item);
                    return false;
                };
				
				
				
				
				
                this.loadGrid = function () {
					console.log('Adding 1 Box');
					changeHand = off;

					console.log('Removing All Grids');
					this.grid.removeAll();
										
					var grid= $('.grid-stack').data('gridstack');
					grid.setAnimation(true);
					
					console.log('Rebuilding All Grids');
                    var items = GridStackUI.Utils.sort(this.serializedData);
                    _.each(items, function (node) {
                        this.grid.addWidget($('<div><div id="'+node.id+'" class="grid-stack-item-content"'+
						'style="color: #2c3e50; text-align: center; background-color: #ffb868;">'+
						'[INSERT CONTENT HERE FOR BOX '+node.id+']'+
						'<div/><div/>'), node.x, node.y, node.width, node.height,false,null,null,null,null, node.id);
							console.log(node)
							/*
							if (Number(node.id)>maxId){
								maxId=Number(node.id);
							}
							*/
							
                    }, this);
					
					//console.log('maxId = '+maxId.toString());
					
					changeHand = on;
					
                    return false;
                }.bind(this);

				
				
				
                this.saveGrid = function () {
                    this.serializedData = _.map($('.grid-stack > .grid-stack-item:visible'), function (el) {
                        el = $(el);
                        var node = el.data('_gridstack_node');
                        return {
                            x: node.x,
                            y: node.y,
                            width: node.width,
                            height: node.height,
							id: node.id
                        };
                    }, this);
                    $('#saved-data').val(JSON.stringify(this.serializedData, null, '    '));
                    return false;
                }.bind(this);

				
				
				
				
				
                this.clearGrid = function () {
				changeHand = off;
                    this.grid.removeAll();
					changeHand = on;
                    return false;
                }.bind(this);
				


								
				
				
                $('#save-grid').click(this.saveGrid);
                $('#load-grid').click(this.loadGrid);
                $('#clear-grid').click(this.clearGrid);
				
				$('#add-box').click(this.addBox);
			

				
				$('.grid-stack').on('change', function(event, ui) {
				
					console.log('Boxes Were Changed');
					console.log('________'+changeHand.toString())
					if (changeHand ==1){
					this.saveGrid();
					}
				}.bind(this));
			
				
				

                this.loadGrid();

				
				
			
		
		
        });
    </script>
	
	
	
</body>
</html>
